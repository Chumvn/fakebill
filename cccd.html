<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake CCCD 2 M·∫∑t - FakeBill</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üÜî</text></svg>">
</head>

<body>
    <div class="container">
        <a href="index.html" class="back-btn">‚Üê Quay l·∫°i</a>

        <header class="header">
            <h1>üÜî Fake CCCD</h1>
            <p>T·∫°o cƒÉn c∆∞·ªõc c√¥ng d√¢n 2 m·∫∑t</p>
        </header>

        <main class="fade-in">
            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" onclick="switchTab('front')">M·∫∑t Tr∆∞·ªõc</div>
                <div class="tab" onclick="switchTab('back')">M·∫∑t Sau</div>
            </div>

            <!-- Front Form -->
            <div id="frontForm" class="card">
                <div class="form-group">
                    <label>S·ªë CCCD</label>
                    <input type="text" class="form-input" id="cccdNumber" placeholder="012345678901"
                        value="079203012345" maxlength="12">
                </div>
                <div class="form-group">
                    <label>H·ªç v√† t√™n</label>
                    <input type="text" class="form-input" id="fullName" placeholder="NGUYEN VAN A" value="NGUYEN VAN A">
                </div>
                <div class="form-group">
                    <label>Ng√†y sinh</label>
                    <input type="date" class="form-input" id="birthDate" value="1990-01-15">
                </div>
                <div class="form-group">
                    <label>Gi·ªõi t√≠nh</label>
                    <select class="form-input" id="gender">
                        <option value="Nam">Nam</option>
                        <option value="N·ªØ">N·ªØ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Qu·ªëc t·ªãch</label>
                    <input type="text" class="form-input" id="nationality" value="Vi·ªát Nam">
                </div>
                <div class="form-group">
                    <label>Qu√™ qu√°n</label>
                    <input type="text" class="form-input" id="hometown" placeholder="X√£ A, Huy·ªán B, T·ªânh C"
                        value="Ph∆∞·ªùng 1, Qu·∫≠n 1, TP H·ªì Ch√≠ Minh">
                </div>
                <div class="form-group">
                    <label>N∆°i th∆∞·ªùng tr√∫</label>
                    <input type="text" class="form-input" id="address" placeholder="123 ƒê∆∞·ªùng ABC"
                        value="123 Nguy·ªÖn Hu·ªá, Qu·∫≠n 1, TP H·ªì Ch√≠ Minh">
                </div>
                <div class="form-group">
                    <label>·∫¢nh ch√¢n dung (3x4)</label>
                    <input type="file" class="form-input" id="photoUpload" accept="image/*">
                </div>
            </div>

            <!-- Back Form -->
            <div id="backForm" class="card hidden">
                <div class="form-group">
                    <label>ƒê·∫∑c ƒëi·ªÉm nh·∫≠n d·∫°ng</label>
                    <textarea class="form-input" id="features" rows="2"
                        placeholder="N·ªët ru·ªìi ·ªü m√° tr√°i">N·ªët ru·ªìi ·ªü c·∫±m</textarea>
                </div>
                <div class="form-group">
                    <label>Ng√†y c·∫•p</label>
                    <input type="date" class="form-input" id="issueDate" value="2021-05-20">
                </div>
                <div class="form-group">
                    <label>C√≥ gi√° tr·ªã ƒë·∫øn</label>
                    <input type="date" class="form-input" id="expiryDate" value="2036-05-20">
                </div>
            </div>

            <!-- Preview -->
            <div class="card">
                <h3 style="margin-bottom:16px; font-weight:600;">Xem tr∆∞·ªõc</h3>
                <div class="preview-area" id="previewArea">
                    <canvas id="cccdCanvas" style="display:none; max-width:100%;"></canvas>
                    <div class="preview-placeholder" id="placeholder">
                        <span>üÜî</span>
                        <p>Nh·∫•n "T·∫°o CCCD" ƒë·ªÉ xem tr∆∞·ªõc</p>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="btn-group">
                <button class="btn btn-primary" onclick="generateCCCD()">‚ú® T·∫°o CCCD</button>
                <button class="btn btn-success" onclick="downloadCCCD()" id="downloadBtn" disabled>üì• T·∫£i ·∫¢nh</button>
            </div>
        </main>

        <footer class="footer">
            <p><a href="https://github.com/chumvn/fakebill" target="_blank">GitHub</a></p>
        </footer>
    </div>

    <script>
        let currentTab = 'front';
        let photoDataUrl = null;
        let generatedCanvas = null;

        // Template positions for CCCD text overlay
        const cccdTemplates = {
            front: {
                src: 'assets/templates/cccd_front.jpg',
                positions: {
                    // Text positions will be calculated based on actual template
                    cccdNumber: { x: 320, y: 180, fontSize: 32, color: '#e60000', font: 'bold' },
                    fullName: { x: 320, y: 260, fontSize: 24, color: '#000' },
                    birthDate: { x: 320, y: 310, fontSize: 20, color: '#000' },
                    gender: { x: 320, y: 350, fontSize: 20, color: '#000' },
                    nationality: { x: 320, y: 390, fontSize: 20, color: '#000' },
                    hometown: { x: 320, y: 430, fontSize: 18, color: '#000' },
                    address: { x: 320, y: 480, fontSize: 16, color: '#000' },
                    photo: { x: 80, y: 200, width: 200, height: 270 }
                }
            },
            back: {
                src: 'assets/templates/cccd_back.jpg',
                positions: {
                    features: { x: 100, y: 200, fontSize: 18, color: '#000' },
                    issueDate: { x: 100, y: 350, fontSize: 18, color: '#000' },
                    expiryDate: { x: 100, y: 400, fontSize: 18, color: '#000' }
                }
            }
        };

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.tab:nth-child(${tab === 'front' ? 1 : 2})`).classList.add('active');
            document.getElementById('frontForm').classList.toggle('hidden', tab !== 'front');
            document.getElementById('backForm').classList.toggle('hidden', tab !== 'back');
        }

        document.getElementById('photoUpload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    photoDataUrl = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('vi-VN');
        }

        async function generateCCCD() {
            const template = cccdTemplates[currentTab];
            const canvas = document.getElementById('cccdCanvas');
            const ctx = canvas.getContext('2d');

            const img = new Image();
            img.crossOrigin = 'anonymous';

            return new Promise((resolve, reject) => {
                img.onload = async () => {
                    canvas.width = img.width;
                    canvas.height = img.height;

                    // Draw template
                    ctx.drawImage(img, 0, 0);

                    if (currentTab === 'front') {
                        const pos = template.positions;

                        // Draw photo if uploaded
                        if (photoDataUrl) {
                            const photoImg = new Image();
                            photoImg.onload = () => {
                                ctx.drawImage(photoImg, pos.photo.x, pos.photo.y, pos.photo.width, pos.photo.height);
                                drawFrontText(ctx, pos);
                            };
                            photoImg.src = photoDataUrl;
                        } else {
                            drawFrontText(ctx, pos);
                        }
                    } else {
                        const pos = template.positions;

                        // Features
                        ctx.font = `${pos.features.fontSize}px Arial`;
                        ctx.fillStyle = pos.features.color;
                        ctx.fillText(document.getElementById('features').value, pos.features.x, pos.features.y);

                        // Issue date
                        ctx.fillText('Ng√†y c·∫•p: ' + formatDate(document.getElementById('issueDate').value), pos.issueDate.x, pos.issueDate.y);

                        // Expiry date
                        ctx.fillText('C√≥ gi√° tr·ªã ƒë·∫øn: ' + formatDate(document.getElementById('expiryDate').value), pos.expiryDate.x, pos.expiryDate.y);
                    }

                    document.getElementById('placeholder').style.display = 'none';
                    canvas.style.display = 'block';
                    document.getElementById('downloadBtn').disabled = false;
                    generatedCanvas = canvas;
                    resolve();
                };

                img.onerror = () => {
                    alert('Kh√¥ng th·ªÉ t·∫£i template. Vui l√≤ng th·ª≠ l·∫°i.');
                    reject();
                };

                img.src = template.src;
            });
        }

        function drawFrontText(ctx, pos) {
            // CCCD Number
            ctx.font = `${pos.cccdNumber.font} ${pos.cccdNumber.fontSize}px Arial`;
            ctx.fillStyle = pos.cccdNumber.color;
            ctx.fillText(document.getElementById('cccdNumber').value, pos.cccdNumber.x, pos.cccdNumber.y);

            // Full name
            ctx.font = `${pos.fullName.fontSize}px Arial`;
            ctx.fillStyle = pos.fullName.color;
            ctx.fillText(document.getElementById('fullName').value.toUpperCase(), pos.fullName.x, pos.fullName.y);

            // Birth date
            ctx.font = `${pos.birthDate.fontSize}px Arial`;
            ctx.fillText(formatDate(document.getElementById('birthDate').value), pos.birthDate.x, pos.birthDate.y);

            // Gender
            ctx.fillText(document.getElementById('gender').value, pos.gender.x, pos.gender.y);

            // Nationality
            ctx.fillText(document.getElementById('nationality').value, pos.nationality.x, pos.nationality.y);

            // Hometown
            ctx.font = `${pos.hometown.fontSize}px Arial`;
            ctx.fillText(document.getElementById('hometown').value, pos.hometown.x, pos.hometown.y);

            // Address
            ctx.font = `${pos.address.fontSize}px Arial`;
            const address = document.getElementById('address').value;
            // Wrap long text
            wrapText(ctx, address, pos.address.x, pos.address.y, 400, 22);
        }

        function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
            const words = text.split(' ');
            let line = '';
            for (let n = 0; n < words.length; n++) {
                const testLine = line + words[n] + ' ';
                const metrics = ctx.measureText(testLine);
                if (metrics.width > maxWidth && n > 0) {
                    ctx.fillText(line, x, y);
                    line = words[n] + ' ';
                    y += lineHeight;
                } else {
                    line = testLine;
                }
            }
            ctx.fillText(line, x, y);
        }

        function downloadCCCD() {
            if (!generatedCanvas) return;

            const link = document.createElement('a');
            link.download = `cccd_${currentTab}_${Date.now()}.png`;
            link.href = generatedCanvas.toDataURL('image/png');
            link.click();
        }
    </script>
</body>

</html>