<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake Bi·∫øn ƒê·ªông S·ªë D∆∞ - FakeBill</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
</head>

<body>
    <div class="container">
        <a href="index.html" class="back-btn">‚Üê Quay l·∫°i</a>

        <header class="header">
            <h1>üìä Fake Bi·∫øn ƒê·ªông S·ªë D∆∞</h1>
            <p>T·∫°o th√¥ng b√°o bi·∫øn ƒë·ªông s·ªë d∆∞</p>
        </header>

        <main class="fade-in">
            <!-- Bank Selection -->
            <div class="card">
                <h3 style="margin-bottom:16px; font-weight:600;">Ch·ªçn ng√¢n h√†ng</h3>
                <div class="bank-grid">
                    <div class="bank-item active" data-bank="bidv" onclick="selectBank('bidv')">
                        <img src="https://api.vietqr.io/img/BIDV.png" alt="BIDV">
                        <span>BIDV</span>
                    </div>
                    <div class="bank-item" data-bank="vcb" onclick="selectBank('vcb')">
                        <img src="https://api.vietqr.io/img/VCB.png" alt="Vietcombank">
                        <span>VCB</span>
                    </div>
                    <div class="bank-item" data-bank="acb" onclick="selectBank('acb')">
                        <img src="https://api.vietqr.io/img/ACB.png" alt="ACB">
                        <span>ACB</span>
                    </div>
                    <div class="bank-item" data-bank="mb" onclick="selectBank('mb')">
                        <img src="https://api.vietqr.io/img/MB.png" alt="MBBank">
                        <span>MBBank</span>
                    </div>
                </div>
            </div>

            <!-- Form -->
            <div class="card">
                <div class="form-group">
                    <label>S·ªë t√†i kho·∫£n</label>
                    <input type="text" class="form-input" id="stk" placeholder="123456789" value="1234567890">
                </div>
                <div class="form-group">
                    <label>S·ªë ti·ªÅn giao d·ªãch</label>
                    <input type="text" class="form-input" id="amount" placeholder="1,000,000" value="1,000,000">
                </div>
                <div class="form-group">
                    <label>Lo·∫°i giao d·ªãch</label>
                    <select class="form-input" id="transType">
                        <option value="+">Ti·ªÅn v√†o (+)</option>
                        <option value="-">Ti·ªÅn ra (-)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>S·ªë d∆∞ cu·ªëi</label>
                    <input type="text" class="form-input" id="sdc" placeholder="5,000,000" value="5,000,000">
                </div>
                <div class="form-group">
                    <label>N·ªôi dung giao d·ªãch</label>
                    <input type="text" class="form-input" id="noidung" placeholder="Noi dung chuyen tien"
                        value="NGUYEN VAN B chuyen tien">
                </div>
                <div class="form-group">
                    <label>Th·ªùi gian</label>
                    <input type="text" class="form-input" id="timeDt" placeholder="12:30 07/02/2026">
                </div>
            </div>

            <!-- Preview -->
            <div class="card">
                <h3 style="margin-bottom:16px; font-weight:600;">Xem tr∆∞·ªõc</h3>
                <div class="preview-area" id="previewArea">
                    <canvas id="bdsdCanvas" style="display:none; max-width:100%;"></canvas>
                    <div class="preview-placeholder" id="placeholder">
                        <span>üìä</span>
                        <p>Nh·∫•n "T·∫°o BƒêSD" ƒë·ªÉ xem tr∆∞·ªõc</p>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="btn-group">
                <button class="btn btn-primary" onclick="generateBDSD()">‚ú® T·∫°o BƒêSD</button>
                <button class="btn btn-success" onclick="downloadBDSD()" id="downloadBtn" disabled>üì• T·∫£i ·∫¢nh</button>
            </div>
        </main>

        <footer class="footer">
            <p><a href="https://github.com/chumvn/fakebill" target="_blank">GitHub</a></p>
        </footer>
    </div>

    <script>
        let selectedBank = 'bidv';
        let generatedCanvas = null;

        // Bank templates with text positions
        const bankTemplates = {
            bidv: {
                src: 'assets/templates/bdsd-bidv.png',
                positions: {
                    content: { x: 163, y: 200, fontSize: 23, color: '#000', lineHeight: 26 }
                }
            },
            vcb: { src: 'assets/templates/bdsd-vcb.png', positions: {} },
            acb: {
                src: 'assets/templates/bdsd-acb.png',
                positions: {
                    content: { x: 100, y: 180, fontSize: 20, color: '#000', lineHeight: 24 }
                }
            },
            mb: { src: 'assets/templates/bdsd-mb.png', positions: {} }
        };

        // Set default time
        const now = new Date();
        document.getElementById('timeDt').value = now.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' }) + ' ' + now.toLocaleDateString('vi-VN');

        function selectBank(bank) {
            selectedBank = bank;
            document.querySelectorAll('.bank-item').forEach(item => {
                item.classList.toggle('active', item.dataset.bank === bank);
            });
        }

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Auto format amount inputs
        ['amount', 'sdc'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                let value = e.target.value.replace(/[^\d]/g, '');
                if (value) {
                    e.target.value = formatNumber(value);
                }
            });
        });

        async function generateBDSD() {
            const template = bankTemplates[selectedBank];
            const canvas = document.getElementById('bdsdCanvas');
            const ctx = canvas.getContext('2d');

            const img = new Image();
            img.crossOrigin = 'anonymous';

            return new Promise((resolve, reject) => {
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;

                    // Draw template
                    ctx.drawImage(img, 0, 0);

                    // Get input values
                    const stk = document.getElementById('stk').value;
                    const amount = document.getElementById('amount').value;
                    const transType = document.getElementById('transType').value;
                    const sdc = document.getElementById('sdc').value;
                    const noidung = document.getElementById('noidung').value;
                    const timeDt = document.getElementById('timeDt').value;

                    if (template.positions.content) {
                        const pos = template.positions.content;

                        // Build notification text
                        const lines = [
                            `${timeDt}. T√†i kho·∫£n thanh to√°n`,
                            `${stk}. S·ªë ti·ªÅn ${transType}${amount}VND. S·ªë d∆∞ cu·ªëi:`,
                            `${sdc}VND N·ªôi dung giao d·ªãch: ${noidung}`
                        ];

                        ctx.font = `${pos.fontSize}px Roboto, sans-serif`;
                        ctx.fillStyle = pos.color;

                        lines.forEach((line, i) => {
                            ctx.fillText(line, pos.x, pos.y + (i * pos.lineHeight));
                        });
                    }

                    document.getElementById('placeholder').style.display = 'none';
                    canvas.style.display = 'block';
                    document.getElementById('downloadBtn').disabled = false;
                    generatedCanvas = canvas;
                    resolve();
                };

                img.onerror = () => {
                    alert('Kh√¥ng th·ªÉ t·∫£i template. Vui l√≤ng th·ª≠ l·∫°i.');
                    reject();
                };

                img.src = template.src;
            });
        }

        function downloadBDSD() {
            if (!generatedCanvas) return;

            const link = document.createElement('a');
            link.download = `bdsd_${selectedBank}_${Date.now()}.png`;
            link.href = generatedCanvas.toDataURL('image/png');
            link.click();
        }
    </script>
</body>

</html>