<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake S·ªë D∆∞ T√†i Kho·∫£n - FakeBill</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí∞</text></svg>">
</head>

<body>
    <div class="container">
        <a href="index.html" class="back-btn">‚Üê Quay l·∫°i</a>

        <header class="header">
            <h1>üí∞ Fake S·ªë D∆∞ TK</h1>
            <p>T·∫°o m√†n h√¨nh s·ªë d∆∞ t√†i kho·∫£n</p>
        </header>

        <main class="fade-in">
            <!-- Bank Selection -->
            <div class="card">
                <h3 style="margin-bottom:16px; font-weight:600;">Ch·ªçn ng√¢n h√†ng</h3>
                <div class="bank-grid">
                    <div class="bank-item active" data-bank="bidv" onclick="selectBank('bidv')">
                        <img src="https://api.vietqr.io/img/BIDV.png" alt="BIDV">
                        <span>BIDV</span>
                    </div>
                    <div class="bank-item" data-bank="vcb" onclick="selectBank('vcb')">
                        <img src="https://api.vietqr.io/img/VCB.png" alt="Vietcombank">
                        <span>VCB</span>
                    </div>
                    <div class="bank-item" data-bank="acb" onclick="selectBank('acb')">
                        <img src="https://api.vietqr.io/img/ACB.png" alt="ACB">
                        <span>ACB</span>
                    </div>
                    <div class="bank-item" data-bank="mb" onclick="selectBank('mb')">
                        <img src="https://api.vietqr.io/img/MB.png" alt="MBBank">
                        <span>MBBank</span>
                    </div>
                </div>
            </div>

            <!-- Form -->
            <div class="card">
                <div class="form-group">
                    <label>T√™n ch·ªß t√†i kho·∫£n</label>
                    <input type="text" class="form-input" id="accountName" placeholder="NGUYEN VAN A"
                        value="NGUYEN VAN A">
                </div>
                <div class="form-group">
                    <label>S·ªë t√†i kho·∫£n</label>
                    <input type="text" class="form-input" id="accountNumber" placeholder="123456789" value="1234567890">
                </div>
                <div class="form-group">
                    <label>S·ªë d∆∞ kh·∫£ d·ª•ng</label>
                    <input type="text" class="form-input" id="balance" placeholder="100,000,000" value="100,000,000">
                </div>
                <div class="form-group">
                    <label>Th·ªùi gian ƒëi·ªán tho·∫°i</label>
                    <input type="text" class="form-input" id="timeDt" placeholder="12:30">
                </div>
            </div>

            <!-- Preview -->
            <div class="card">
                <h3 style="margin-bottom:16px; font-weight:600;">Xem tr∆∞·ªõc</h3>
                <div class="preview-area" id="previewArea">
                    <canvas id="soduCanvas" style="display:none; max-width:100%;"></canvas>
                    <div class="preview-placeholder" id="placeholder">
                        <span>üí∞</span>
                        <p>Nh·∫•n "T·∫°o S·ªë D∆∞" ƒë·ªÉ xem tr∆∞·ªõc</p>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="btn-group">
                <button class="btn btn-primary" onclick="generateSoDu()">‚ú® T·∫°o S·ªë D∆∞</button>
                <button class="btn btn-success" onclick="downloadSoDu()" id="downloadBtn" disabled>üì• T·∫£i ·∫¢nh</button>
            </div>
        </main>

        <footer class="footer">
            <p><a href="https://github.com/chumvn/fakebill" target="_blank">GitHub</a></p>
        </footer>
    </div>

    <script>
        let selectedBank = 'bidv';
        let generatedCanvas = null;

        // Bank templates with text positions
        const bankTemplates = {
            bidv: {
                src: 'assets/templates/sodu-bidv.png',
                positions: {
                    time: { x: 110, y: 65, fontSize: 27, color: '#000' },
                    balance: { x: 'center', y: 500, fontSize: 40, color: '#fff' },
                    accountName: { x: 'center', y: 350, fontSize: 24, color: '#fff' },
                    accountNumber: { x: 'center', y: 400, fontSize: 20, color: 'rgba(255,255,255,0.7)' }
                }
            },
            vcb: { src: 'assets/templates/sodu-vcb.png', positions: {} },
            acb: { src: 'assets/templates/sodu-acb.png', positions: {} },
            mb: { src: 'assets/templates/sodu-mb.png', positions: {} }
        };

        // Set default time
        const now = new Date();
        document.getElementById('timeDt').value = now.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });

        function selectBank(bank) {
            selectedBank = bank;
            document.querySelectorAll('.bank-item').forEach(item => {
                item.classList.toggle('active', item.dataset.bank === bank);
            });
        }

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Auto format balance input
        document.getElementById('balance').addEventListener('input', (e) => {
            let value = e.target.value.replace(/[^\d]/g, '');
            if (value) {
                e.target.value = formatNumber(value);
            }
        });

        async function generateSoDu() {
            const template = bankTemplates[selectedBank];
            const canvas = document.getElementById('soduCanvas');
            const ctx = canvas.getContext('2d');

            const img = new Image();
            img.crossOrigin = 'anonymous';

            return new Promise((resolve, reject) => {
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;

                    // Draw template
                    ctx.drawImage(img, 0, 0);

                    // Get input values
                    const accountName = document.getElementById('accountName').value.toUpperCase();
                    const accountNumber = document.getElementById('accountNumber').value;
                    const balance = document.getElementById('balance').value;
                    const timeDt = document.getElementById('timeDt').value;

                    const pos = template.positions;

                    // Time
                    if (pos.time) {
                        ctx.font = `${pos.time.fontSize}px -apple-system, sans-serif`;
                        ctx.fillStyle = pos.time.color;
                        ctx.fillText(timeDt.substring(0, 5), pos.time.x, pos.time.y);
                    }

                    // Account Name (centered)
                    if (pos.accountName) {
                        ctx.font = `bold ${pos.accountName.fontSize}px Arial, sans-serif`;
                        ctx.fillStyle = pos.accountName.color;
                        const textWidth = ctx.measureText(accountName).width;
                        ctx.fillText(accountName, (canvas.width - textWidth) / 2, pos.accountName.y);
                    }

                    // Account Number (centered)
                    if (pos.accountNumber) {
                        ctx.font = `${pos.accountNumber.fontSize}px Arial, sans-serif`;
                        ctx.fillStyle = pos.accountNumber.color;
                        const textWidth = ctx.measureText(accountNumber).width;
                        ctx.fillText(accountNumber, (canvas.width - textWidth) / 2, pos.accountNumber.y);
                    }

                    // Balance (centered)
                    if (pos.balance) {
                        const balanceText = balance + ' VND';
                        ctx.font = `bold ${pos.balance.fontSize}px Arial, sans-serif`;
                        ctx.fillStyle = pos.balance.color;
                        const textWidth = ctx.measureText(balanceText).width;
                        ctx.fillText(balanceText, (canvas.width - textWidth) / 2, pos.balance.y);
                    }

                    document.getElementById('placeholder').style.display = 'none';
                    canvas.style.display = 'block';
                    document.getElementById('downloadBtn').disabled = false;
                    generatedCanvas = canvas;
                    resolve();
                };

                img.onerror = () => {
                    alert('Kh√¥ng th·ªÉ t·∫£i template. Vui l√≤ng th·ª≠ l·∫°i.');
                    reject();
                };

                img.src = template.src;
            });
        }

        function downloadSoDu() {
            if (!generatedCanvas) return;

            const link = document.createElement('a');
            link.download = `sodu_${selectedBank}_${Date.now()}.png`;
            link.href = generatedCanvas.toDataURL('image/png');
            link.click();
        }
    </script>
</body>

</html>