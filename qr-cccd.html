<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·∫°o QR CCCD - FakeBill</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì±</text></svg>">
    <style>
        .qr-preview {
            background: white;
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            max-width: 300px;
            margin: 0 auto;
        }

        .qr-preview canvas {
            max-width: 100%;
            margin-bottom: 16px;
        }

        .qr-info {
            text-align: left;
            background: #f5f5f5;
            border-radius: 8px;
            padding: 12px;
            font-size: 0.75rem;
            color: #333;
        }

        .qr-info div {
            margin-bottom: 4px;
        }

        .qr-info .label {
            color: #666;
        }
    </style>
</head>

<body>
    <div class="container">
        <a href="index.html" class="back-btn">‚Üê Quay l·∫°i</a>

        <header class="header">
            <h1>üì± T·∫°o QR CCCD</h1>
            <p>T·∫°o m√£ QR cƒÉn c∆∞·ªõc c√¥ng d√¢n</p>
        </header>

        <main class="fade-in">
            <!-- Form -->
            <div class="card">
                <div class="form-group">
                    <label>S·ªë CCCD (12 s·ªë)</label>
                    <input type="text" class="form-input" id="cccdNumber" placeholder="079203012345"
                        value="079203012345" maxlength="12">
                </div>
                <div class="form-group">
                    <label>S·ªë CMND c≈© (9 s·ªë, kh√¥ng b·∫Øt bu·ªôc)</label>
                    <input type="text" class="form-input" id="cmndNumber" placeholder="123456789" maxlength="9">
                </div>
                <div class="form-group">
                    <label>H·ªç v√† t√™n</label>
                    <input type="text" class="form-input" id="fullName" placeholder="NGUYEN VAN A" value="NGUYEN VAN A">
                </div>
                <div class="form-group">
                    <label>Ng√†y sinh (dd/mm/yyyy)</label>
                    <input type="text" class="form-input" id="birthDate" placeholder="15/01/1990" value="15/01/1990">
                </div>
                <div class="form-group">
                    <label>Gi·ªõi t√≠nh</label>
                    <select class="form-input" id="gender">
                        <option value="Nam">Nam</option>
                        <option value="N·ªØ">N·ªØ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫</label>
                    <textarea class="form-input" id="address" rows="2"
                        placeholder="123 ƒê∆∞·ªùng ABC, Ph∆∞·ªùng XYZ, Qu·∫≠n 1, TP H·ªì Ch√≠ Minh">123 Nguy·ªÖn Hu·ªá, Ph∆∞·ªùng B·∫øn Ngh√©, Qu·∫≠n 1, TP H·ªì Ch√≠ Minh</textarea>
                </div>
                <div class="form-group">
                    <label>Ng√†y c·∫•p CCCD (dd/mm/yyyy)</label>
                    <input type="text" class="form-input" id="issueDate" placeholder="20/05/2021" value="20/05/2021">
                </div>
            </div>

            <!-- Preview -->
            <div class="card">
                <h3 style="margin-bottom:16px; font-weight:600;">M√£ QR CCCD</h3>
                <div class="preview-area" id="previewArea">
                    <div id="qrPreview" class="qr-preview" style="display:none;">
                        <canvas id="qrCanvas"></canvas>
                        <div class="qr-info">
                            <div><span class="label">S·ªë CCCD:</span> <span id="infoNumber">079203012345</span></div>
                            <div><span class="label">H·ªç t√™n:</span> <span id="infoName">NGUYEN VAN A</span></div>
                            <div><span class="label">Ng√†y sinh:</span> <span id="infoDob">15/01/1990</span></div>
                        </div>
                    </div>
                    <div class="preview-placeholder" id="placeholder">
                        <span>üì±</span>
                        <p>Nh·∫•n "T·∫°o QR" ƒë·ªÉ t·∫°o m√£</p>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="btn-group">
                <button class="btn btn-primary" onclick="generateQR()">‚ú® T·∫°o QR</button>
                <button class="btn btn-success" onclick="downloadQR()" id="downloadBtn" disabled>üì• T·∫£i ·∫¢nh</button>
            </div>
        </main>

        <footer class="footer">
            <p><a href="https://github.com/chumvn/fakebill" target="_blank">GitHub</a></p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        function generateQR() {
            const cccdNumber = document.getElementById('cccdNumber').value;
            const cmndNumber = document.getElementById('cmndNumber').value || '';
            const fullName = document.getElementById('fullName').value;
            const birthDate = document.getElementById('birthDate').value;
            const gender = document.getElementById('gender').value;
            const address = document.getElementById('address').value;
            const issueDate = document.getElementById('issueDate').value;

            // Format QR data theo chu·∫©n CCCD chip
            // Format: CCCD|CMND|Name|DOB|Gender|Address|IssueDate
            const qrData = [
                cccdNumber,
                cmndNumber,
                fullName,
                birthDate,
                gender,
                address,
                issueDate
            ].join('|');

            // Generate QR
            const canvas = document.getElementById('qrCanvas');
            QRCode.toCanvas(canvas, qrData, {
                width: 200,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#ffffff'
                }
            }, (error) => {
                if (error) {
                    console.error(error);
                    alert('L·ªói t·∫°o m√£ QR');
                    return;
                }

                // Update info
                document.getElementById('infoNumber').textContent = cccdNumber;
                document.getElementById('infoName').textContent = fullName;
                document.getElementById('infoDob').textContent = birthDate;

                document.getElementById('placeholder').style.display = 'none';
                document.getElementById('qrPreview').style.display = 'block';
                document.getElementById('downloadBtn').disabled = false;
            });
        }

        async function downloadQR() {
            const preview = document.getElementById('qrPreview');
            try {
                const canvas = await html2canvas(preview, {
                    scale: 2,
                    backgroundColor: '#ffffff'
                });
                const link = document.createElement('a');
                link.download = `qr_cccd_${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            } catch (error) {
                alert('C√≥ l·ªói khi t·∫°o ·∫£nh.');
            }
        }
    </script>
</body>

</html>