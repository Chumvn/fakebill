<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake Bill Chuy·ªÉn Kho·∫£n - FakeBill</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí∏</text></svg>">
</head>

<body>
    <div class="container">
        <a href="index.html" class="back-btn">‚Üê Quay l·∫°i</a>

        <header class="header">
            <h1>üí∏ Fake Bill Chuy·ªÉn Kho·∫£n</h1>
            <p>T·∫°o bill chuy·ªÉn kho·∫£n ng√¢n h√†ng</p>
        </header>

        <main class="fade-in">
            <!-- Bank Selection -->
            <div class="card">
                <h3 style="margin-bottom:16px; font-weight:600;">Ch·ªçn ng√¢n h√†ng</h3>
                <div class="bank-grid">
                    <div class="bank-item active" data-bank="bidv" onclick="selectBank('bidv')">
                        <img src="https://api.vietqr.io/img/BIDV.png" alt="BIDV">
                        <span>BIDV</span>
                    </div>
                    <div class="bank-item" data-bank="vcb" onclick="selectBank('vcb')">
                        <img src="https://api.vietqr.io/img/VCB.png" alt="Vietcombank">
                        <span>VCB</span>
                    </div>
                    <div class="bank-item" data-bank="acb" onclick="selectBank('acb')">
                        <img src="https://api.vietqr.io/img/ACB.png" alt="ACB">
                        <span>ACB</span>
                    </div>
                    <div class="bank-item" data-bank="mb" onclick="selectBank('mb')">
                        <img src="https://api.vietqr.io/img/MB.png" alt="MBBank">
                        <span>MBBank</span>
                    </div>
                    <div class="bank-item" data-bank="tcb" onclick="selectBank('tcb')">
                        <img src="https://api.vietqr.io/img/TCB.png" alt="Techcombank">
                        <span>TCB</span>
                    </div>
                    <div class="bank-item" data-bank="agri" onclick="selectBank('agri')">
                        <img src="https://api.vietqr.io/img/ICB.png" alt="Agribank">
                        <span>Agribank</span>
                    </div>
                </div>
            </div>

            <!-- Form -->
            <div class="card">
                <div class="form-group">
                    <label>S·ªë ti·ªÅn chuy·ªÉn</label>
                    <input type="text" class="form-input" id="amount" placeholder="100,000" value="1,000,000">
                </div>
                <div class="form-group">
                    <label>S·ªë t√†i kho·∫£n ng∆∞·ªùi nh·∫≠n</label>
                    <input type="text" class="form-input" id="stkNhan" placeholder="123456789" value="1234567890">
                </div>
                <div class="form-group">
                    <label>T√™n ng∆∞·ªùi nh·∫≠n</label>
                    <input type="text" class="form-input" id="nameNhan" placeholder="NGUYEN VAN A" value="NGUYEN VAN A">
                </div>
                <div class="form-group">
                    <label>Ng√¢n h√†ng nh·∫≠n</label>
                    <select class="form-input" id="bankNhan">
                        <option value="BIDV">BIDV</option>
                        <option value="Vietcombank">Vietcombank</option>
                        <option value="ACB">ACB</option>
                        <option value="MBBank">MBBank</option>
                        <option value="Techcombank">Techcombank</option>
                        <option value="Agribank">Agribank</option>
                        <option value="VPBank">VPBank</option>
                        <option value="TPBank">TPBank</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>N·ªôi dung chuy·ªÉn kho·∫£n</label>
                    <input type="text" class="form-input" id="noidung" placeholder="Chuyen tien" value="Chuyen tien">
                </div>
                <div class="form-group">
                    <label>Th·ªùi gian ƒëi·ªán tho·∫°i</label>
                    <input type="text" class="form-input" id="timeDt" placeholder="12:30">
                </div>
                <div class="form-group">
                    <label>Th·ªùi gian tr√™n bill</label>
                    <input type="text" class="form-input" id="timeBill" placeholder="07/02/2026">
                </div>
                <div class="form-group">
                    <label>M√£ giao d·ªãch</label>
                    <input type="text" class="form-input" id="magiaodich" placeholder="123456">
                </div>
            </div>

            <!-- Preview -->
            <div class="card">
                <h3 style="margin-bottom:16px; font-weight:600;">Xem tr∆∞·ªõc</h3>
                <div class="preview-area" id="previewArea">
                    <canvas id="billCanvas" style="display:none; max-width:100%;"></canvas>
                    <div class="preview-placeholder" id="placeholder">
                        <span>üí∏</span>
                        <p>Nh·∫•n "T·∫°o Bill" ƒë·ªÉ xem tr∆∞·ªõc</p>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="btn-group">
                <button class="btn btn-primary" onclick="generateBill()">‚ú® T·∫°o Bill</button>
                <button class="btn btn-success" onclick="downloadBill()" id="downloadBtn" disabled>üì• T·∫£i ·∫¢nh</button>
            </div>
        </main>

        <footer class="footer">
            <p><a href="https://github.com/chumvn/fakebill" target="_blank">GitHub</a></p>
        </footer>
    </div>

    <script>
        let selectedBank = 'bidv';
        let templateImage = null;

        // Bank templates with text positions
        const bankTemplates = {
            bidv: {
                src: 'assets/templates/bidv.png',
                textPositions: {
                    time: { x: 110, y: 65, fontSize: 27, color: '#000', font: 'SFProText-Semibold' },
                    amount: { x: 'center', y: 690, fontSize: 36, color: '#0380ad', font: 'Mulish-Bold' },
                    magiaodich: { x: 'right', y: 756, fontSize: 23, color: '#757575', font: 'Mulish-Bold', rightOffset: 315 },
                    description: { x: 'center', y: 850, fontSize: 26, color: '#3d4457', font: 'Mulish-SemiBold' }
                }
            },
            vcb: {
                src: 'assets/templates/vcb.png',
                textPositions: {
                    time: { x: 110, y: 65, fontSize: 27, color: '#000', font: 'SFProText-Semibold' },
                    amount: { x: 'center', y: 650, fontSize: 36, color: '#006b4d', font: 'Mulish-Bold' },
                    magiaodich: { x: 'right', y: 720, fontSize: 23, color: '#757575', font: 'Mulish-Bold', rightOffset: 315 },
                    description: { x: 'center', y: 800, fontSize: 26, color: '#3d4457', font: 'Mulish-SemiBold' }
                }
            },
            acb: {
                src: 'assets/templates/acb.png',
                textPositions: {
                    time: { x: 110, y: 65, fontSize: 27, color: '#000', font: 'SFProText-Semibold' },
                    amount: { x: 'center', y: 690, fontSize: 36, color: '#e30613', font: 'Mulish-Bold' },
                    magiaodich: { x: 'right', y: 756, fontSize: 23, color: '#757575', font: 'Mulish-Bold', rightOffset: 315 },
                    description: { x: 'center', y: 850, fontSize: 26, color: '#3d4457', font: 'Mulish-SemiBold' }
                }
            },
            mb: { src: 'assets/templates/mb.png', textPositions: {} },
            tcb: { src: 'assets/templates/tcb.png', textPositions: {} },
            agri: { src: 'assets/templates/agribank.png', textPositions: {} }
        };

        // Set default time
        const now = new Date();
        document.getElementById('timeDt').value = now.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
        document.getElementById('timeBill').value = now.toLocaleDateString('vi-VN');
        document.getElementById('magiaodich').value = Math.floor(100000 + Math.random() * 900000);

        function selectBank(bank) {
            selectedBank = bank;
            document.querySelectorAll('.bank-item').forEach(item => {
                item.classList.toggle('active', item.dataset.bank === bank);
            });
        }

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Auto format amount input
        document.getElementById('amount').addEventListener('input', (e) => {
            let value = e.target.value.replace(/[^\d]/g, '');
            if (value) {
                e.target.value = formatNumber(value);
            }
        });

        async function generateBill() {
            const template = bankTemplates[selectedBank];
            const canvas = document.getElementById('billCanvas');
            const ctx = canvas.getContext('2d');

            // Load template image
            const img = new Image();
            img.crossOrigin = 'anonymous';

            return new Promise((resolve, reject) => {
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;

                    // Draw template
                    ctx.drawImage(img, 0, 0);

                    // Get input values
                    const amount = document.getElementById('amount').value;
                    const stkNhan = document.getElementById('stkNhan').value;
                    const nameNhan = document.getElementById('nameNhan').value.toUpperCase();
                    const bankNhan = document.getElementById('bankNhan').value;
                    const noidung = document.getElementById('noidung').value;
                    const timeDt = document.getElementById('timeDt').value;
                    const timeBill = document.getElementById('timeBill').value;
                    const magiaodich = document.getElementById('magiaodich').value;

                    // Draw text overlays
                    const pos = template.textPositions;

                    // Time
                    if (pos.time) {
                        ctx.font = `${pos.time.fontSize}px -apple-system, BlinkMacSystemFont, sans-serif`;
                        ctx.fillStyle = pos.time.color;
                        ctx.fillText(timeDt.substring(0, 5), pos.time.x, pos.time.y);
                    }

                    // Amount (centered)
                    if (pos.amount) {
                        const amountText = amount + ' VND';
                        ctx.font = `bold ${pos.amount.fontSize}px Mulish, sans-serif`;
                        ctx.fillStyle = pos.amount.color;
                        const textWidth = ctx.measureText(amountText).width;
                        const x = (canvas.width - textWidth) / 2;
                        ctx.fillText(amountText, x, pos.amount.y);
                    }

                    // M√£ giao d·ªãch (right aligned)
                    if (pos.magiaodich) {
                        ctx.font = `bold ${pos.magiaodich.fontSize}px Mulish, sans-serif`;
                        ctx.fillStyle = pos.magiaodich.color;
                        const textWidth = ctx.measureText(magiaodich).width;
                        const x = canvas.width - pos.magiaodich.rightOffset - textWidth;
                        ctx.fillText(magiaodich, x, pos.magiaodich.y);
                    }

                    // Description (centered, multiline)
                    if (pos.description) {
                        const descLine1 = 'Qu√Ω kh√°ch ƒë√£ chuy·ªÉn th√†nh c√¥ng ƒë·∫øn s·ªë t√†i';
                        const descLine2 = `kho·∫£n ${stkNhan}/ ${nameNhan}/ NH ${bankNhan}`;
                        const descLine3 = `v√†o l√∫c ${timeBill} ${timeDt} N·ªôi dung: ${noidung}`;

                        ctx.font = `${pos.description.fontSize}px Mulish, sans-serif`;
                        ctx.fillStyle = pos.description.color;

                        // Line 1
                        let textWidth = ctx.measureText(descLine1).width;
                        ctx.fillText(descLine1, (canvas.width - textWidth) / 2, pos.description.y);

                        // Line 2 (with blue color for account info)
                        const lineY2 = pos.description.y + 60;
                        ctx.fillStyle = '#0066ad';
                        ctx.font = `bold ${pos.description.fontSize}px Mulish, sans-serif`;
                        textWidth = ctx.measureText(descLine2).width;
                        ctx.fillText(descLine2, (canvas.width - textWidth) / 2, lineY2);

                        // Line 3
                        const lineY3 = lineY2 + 60;
                        ctx.fillStyle = pos.description.color;
                        ctx.font = `${pos.description.fontSize}px Mulish, sans-serif`;
                        textWidth = ctx.measureText(descLine3).width;
                        ctx.fillText(descLine3, (canvas.width - textWidth) / 2, lineY3);
                    }

                    document.getElementById('placeholder').style.display = 'none';
                    canvas.style.display = 'block';
                    document.getElementById('downloadBtn').disabled = false;

                    templateImage = canvas;
                    resolve();
                };

                img.onerror = () => {
                    alert('Kh√¥ng th·ªÉ t·∫£i template. Vui l√≤ng th·ª≠ l·∫°i.');
                    reject();
                };

                img.src = template.src;
            });
        }

        function downloadBill() {
            if (!templateImage) return;

            const link = document.createElement('a');
            link.download = `bill_${selectedBank}_${Date.now()}.png`;
            link.href = templateImage.toDataURL('image/png');
            link.click();
        }
    </script>
</body>

</html>